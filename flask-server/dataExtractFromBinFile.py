import pefile
import os

def extract_pe_sections(binary_file):
    try:
        # Load the PE file
        pe = pefile.PE(binary_file)

        sections = {}

        # Extract section data
        for section in pe.sections:
            section_name = section.Name.decode().rstrip('\x00')
            if section_name in ['.text', '.rdata', '.data', '.rsrc']:
                sections[section_name.lstrip('.')] = section.get_data()

        return sections
    except Exception as e:
        print(f"Error extracting PE sections: {e}")
        return {}

def save_section_data(sections, output_directory):
    try:
        if not os.path.exists(output_directory):
            os.makedirs(output_directory)

        saved_files = []

        for section_name, data in sections.items():
            output_file = os.path.join(output_directory, f"{section_name}.hex")
            with open(output_file, 'w') as file:
                file.write(data.hex())
            saved_files.append(os.path.abspath(output_file))

        return saved_files

    except Exception as e:
        print(f"Error saving section data: {e}")
        return []

binary_file = 'path_to_your_pe_file.exe'
output_directory = 'output_sections'

sections = extract_pe_sections(binary_file)
saved_files = save_section_data(sections, output_directory)

print("Saved files:", saved_files)
