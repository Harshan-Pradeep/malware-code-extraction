import React, { useState } from 'react';
import NavBar from '../components/NavBar';
import FileUpload from '../components/FIleUpload';
import ImageComponent from '../components/DataComponent';
import TableComponent from '../components/TableData';
import FooterComponent from '../components/Footer';
import Typography from '@mui/material/Typography';
import TechnicalDataTable from '../components/TechnicalDataTable';
import ExtractedFileDataTable from '../components/ExtractedFileDataTable';
import Box from '@mui/material/Box';
import Skeleton from '@mui/material/Skeleton';
import './styles.css';

function MainLandingPage() {
    const [responseData, setResponseData] = useState({});

    // Function to handle setting the responseData
    const handleResponseData = (data) => {
        setResponseData(data);
    };

    let malwareName = responseData && responseData.prediction ? responseData.prediction : "";

    const blinkClass = !Object.keys(responseData).length ? 'blink' : '';

    // Helper function to render Skeleton or actual component
    const renderWithSkeleton = (condition, component) => {
        return condition ? component : (
            <Box sx={{ width: '100%' }}>
                <Skeleton />
                <Skeleton animation="wave" />
                <Skeleton animation={false} />
            </Box>
        );
    };

    return (
        <>
            <FileUpload onDataReceived={handleResponseData} />

            <Typography 
                variant="h3" 
                component="h3" 
                gutterBottom 
                sx={{ 
                    textAlign: 'center', 
                    color: 'red', 
                    mt: 3, 
                }}
            >
                {malwareName || <Skeleton width="60%" />}
            </Typography>

            {renderWithSkeleton(responseData.imageFilePath, <ImageComponent data={responseData} />)}

            <Typography variant="h6" component="h6" gutterBottom className={blinkClass}>
                Overview Details
            </Typography>

            {renderWithSkeleton(Object.keys(responseData).length, <TableComponent data={responseData} className={blinkClass} />)}

            <Typography variant="h6" component="h6" gutterBottom sx={{ mt: 5 }} className={blinkClass}>
                Technical Details
            </Typography>

            {renderWithSkeleton(Object.keys(responseData).length, <TechnicalDataTable data={responseData} className={blinkClass} />)}

            <Typography variant="h6" component="h6" gutterBottom sx={{ mt: 5 }} className={blinkClass}>
                Extracted Files
            </Typography>
            
            {renderWithSkeleton(Object.keys(responseData).length, <ExtractedFileDataTable data={responseData} className={blinkClass} />)}
            
        </>
    );
}

export default MainLandingPage;
