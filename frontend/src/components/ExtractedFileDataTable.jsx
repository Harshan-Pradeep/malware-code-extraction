import React from 'react';
import {
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  IconButton,
} from '@mui/material';
import DownloadIcon from '@mui/icons-material/Download';
import '../pages/styles.css';

const ExtractedFileDataTable = ({ data }) => {
  const blinkClass = !Object.keys(data).length ? 'blink' : '';

  const downloadFile = (path) => {
    // Ensure no double .bin extensions
    const correctedPath = path.replace(/\.bin\.bin$/, '.bin');
    const link = document.createElement('a');
    link.href = `http://localhost:8000/${correctedPath}`;
    link.download = correctedPath.split('/').pop();
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const getFileName = (path) => {
    if (!path) return '';
    const correctedPath = path.replace(/\.bin\.bin$/, '.bin');
    return correctedPath.split('\\').pop();
  };

  return (
    <div>
      <TableContainer component={Paper} className={blinkClass}>
        <Table sx={{ minWidth: 650 }} aria-label="simple table">
          <TableHead>
            <TableRow sx={{ backgroundColor: '#3aba2f' }}>
              <TableCell sx={{ width: '30%', borderRight: '1px solid grey', color: 'white' }}>
                Title
              </TableCell>
              <TableCell sx={{ width: '70%', color: 'white' }}>Data</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {[
              { label: '.rsrc', value: data?.rsrc_path },
              { label: '.text', value: data?.text_path },
              { label: '.rdata', value: data?.rdata_path },
              { label: '.data', value: data?.data_path },
            ].map((row, index) => (
              <TableRow key={index}>
                <TableCell sx={{ width: '30%', borderRight: '1px solid grey' }}>
                  {row.label}
                </TableCell>
                <TableCell sx={{ width: '70%' }}>
                  {row.value ? (
                    <div style={{ display: 'flex', alignItems: 'center' }}>
                      {getFileName(row.value)}
                      <IconButton onClick={() => downloadFile(row.value)} sx={{ marginLeft: 1 }}>
                        <DownloadIcon />
                      </IconButton>
                    </div>
                  ) : (
                    ''
                  )}
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    </div>
  );
};

export default ExtractedFileDataTable;
